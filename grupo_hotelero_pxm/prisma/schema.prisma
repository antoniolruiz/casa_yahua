generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Hotel {
  id           String     @id @default(cuid())
  name         String
  description  String
  location     String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  listings     Listing[]
}

model Listing {
  id               String    @id @default(cuid())
  hotelId          String
  hotel            Hotel     @relation(fields: [hotelId], references: [id])
  airbnbId         String
  airbnbUrl        String
  icalUrl          String?
  title            String
  baseCurrency     String    @default("USD")
  nightlyBasePrice Int       @default(0)
  images           Image[]
  calendarSources  CalendarSource[]
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  bookings         Booking[]
}

model Image {
  id        String   @id @default(cuid())
  listingId String
  listing   Listing  @relation(fields: [listingId], references: [id])
  url       String
  position  Int
}

model CalendarSource {
  id        String   @id @default(cuid())
  name      String
  icalUrl   String   @unique
  listingId String?
  listing   Listing? @relation(fields: [listingId], references: [id])
  createdAt DateTime @default(now())
}

model Booking {
  id            String   @id @default(cuid())
  listingId     String
  listing       Listing  @relation(fields: [listingId], references: [id])
  guestEmail    String
  guestPhone    String
  startDate     DateTime
  endDate       DateTime
  totalPriceCents Int
  currency      String   @default("USD")
  stripePaymentIntentId String?
  status        BookingStatus @default(PENDING)
  createdAt     DateTime @default(now())
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELED
}


